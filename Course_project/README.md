<b>*В данном курсовом проекте стояла задача создать чат-бота для Telegram.*  
*Бот должен иметь не менее трёх интентов и использовать дообученные NLP-модели.*</b>  
  
В результате работы над курсовым проектом был создан бот, имеющий 3 интента:  
1) Умеет выдавать текущую погоду в российском городе (ограничение API по стране).  
2) Отвечает на вопросы по неким фактам, если они имеются в базе.  
3) Разговорный бот, умеющий вести диалог с запоминанием контекста.  
  
*Код бота - [bot.py](bot.py)*  
*Ноутбук с подготовкой данных и обучением моделей - [project.ipynb](project.ipynb)*  
  
В первую очередь бот с помощью библиотеки [py3langid](https://pypi.org/project/py3langid/) проверяет, на русском ли языке  
написано сообщение. Если нет, то просит написать на русском:  
  
<img src="https://user-images.githubusercontent.com/77928025/217001811-49f63463-9ca8-4854-8a92-d29626cdce80.png" width="600" />   
  
В основу разговорного бота легла [маленькая версия модели ruGPT-3 от Сбера](https://huggingface.co/sberbank-ai/rugpt3small_based_on_gpt2), которая  
была дообучена на 10000 диалогах из датасета *"Toloka Persona Chat Rus"*.  
Бот умеет вести беседу, при этом запоминает контекст из 8 последних сообщений:

<img src="https://user-images.githubusercontent.com/77928025/217002368-121fe917-d501-4c8e-8c10-f8bc36facab7.png" width="600" />  
  
Также бот умеет говорить текущую погоду. Для этого в сообщении пользователя ищутся  
ключевые леммы слов, такие как "погод", "температур" и др. При нахождении такого слова  
сообщение передаётся модели NER из библиотеки [spaCy](https://spacy.io/), которая ищет в тексте сущность  
локации (населённого пункта). По названию населённого пункта находятся его координаты,  
для чего используется [API геолокации от DaData.](https://dadata.ru/api/suggest/address/)    
Полученные координаты объекта затем передаются [погодному API от Яндекса](https://yandex.ru/dev/weather/), и  
результат, после обработки, выводится в чат:  

<img src="https://user-images.githubusercontent.com/77928025/217002463-dc8a9278-77b8-46cf-8d2c-75c93a174c40.png" width="600" />  
  
Ещё бот может давать ответы на вопросы, которые есть в базе. Для этого бралась  
предобученная модель [paraphrase-multilingual-mpnet-base-v2](https://huggingface.co/sentence-transformers/paraphrase-multilingual-mpnet-base-v2) от команды sentence-transformers.  
Эта модель основывается на модели xlm-roberta-base и делает эмбеддинги текстов.  
В нашем случае делаем эмбеддинги всех вопросов в базе и эмбеддинг вопроса пользователя.  
Передаём эмбеддинги вопросов из базы модели [annoy](https://pypi.org/project/annoy/) и строим индекс. Затем эта модель  
берёт эмбеддинг вопроса пользователя и находит ближайший к нему эмбеддинг вопроса  
из базы по косинусному расстоянию. Если расстояние не превышает определённый порог  
(найденный эмпирически), то модель возвращает из базы ответ на ближайший вопрос.  
В качестве базы вопросов и ответов был взять датасет  
*"RuBQ 2.0: An Innovated Russian Question Answering Dataset от Toloka".*  
Ссылка на него и на предыдущий датасет с диалогами - [link](https://toloka.ai/datasets/?page=1&category=nlp)  
  
<img src="https://user-images.githubusercontent.com/77928025/217002527-af362975-962e-4748-948b-970cff0dcfcd.png" width="600" />  
  
<ins>Общий пайплайн работы бота:</ins>  
1) Проверка на язык. Если не русский, то выводит сообщение.  
2) Проверка на погодный запрос. Если не нашлись ключевые слова или сущность локации, то сообщение  
передаётся дальше по пайплайну.  
3) Проверка на вопрос из базы. Для этого сообщение прогоняется через бертовую модель и находится  
расстояние до ближайшего вопроса из базы. Если расстояние выше порога, то сообщение передаётся дальше  
разговорному боту.  
4) Разговорный бот. Сообщения, которые прошли все вышеперечисленные фильтры считаются сообщениями  
беседы и передаются модели GPT для генерации ответа.
